import{q as f,r as m,f as x,j as e,a as N}from"./app-BcNu5yVF.js";import{A as v}from"./AuthenticatedLayout-DCQ1tQfo.js";import"./transition-DspvlAA8.js";function k(){const{auth:h,cart:d=[]}=f().props,p=h.user,l=d.reduce((a,r)=>a+Number(r.price)*r.quantity,0),[t,y]=m.useState({name:p.name||"",email:p.email||"",address:"",city:"",paymentMethod:"card",cardNumber:"",expirationDate:""}),n=a=>{const{name:r,value:s}=a.target;y({...t,[r]:s})},b=a=>{a.preventDefault();const r=d.map(s=>({product_id:s.id,quantity:s.quantity,price:Number(s.price)}));x.post(route("checkout.store"),{...t,cart:r,total:l})};return m.useEffect(()=>{if(t.paymentMethod!=="paypal")return;const a=setInterval(()=>{const r=document.getElementById("paypal-button-container");if(!r)return;if(r.hasChildNodes()){clearInterval(a);return}if(document.querySelector('script[src*="paypal.com/sdk/js"]'))u();else{const c=document.createElement("script");c.src="https://www.paypal.com/sdk/js?client-id=Af_uSCl9jdp8VB-NQro2lgF-qTUnWW_iK7vh7nzrvtT3ZXPSX5bC3XbWuXRq56O4ejeLnvzBHbmvnQ8og&currency=EUR",c.addEventListener("load",u),document.body.appendChild(c)}function u(){window.paypal&&window.paypal.Buttons({createOrder:(c,o)=>o.order.create({purchase_units:[{amount:{value:l.toFixed(2)}}]}),onApprove:(c,o)=>o.order.capture().then(g=>{const j=d.map(i=>({product_id:i.id,quantity:i.quantity,price:Number(i.price)}));x.post(route("checkout.paypal.complete"),{...t,cart:j,total:l,paypalDetails:g})})}).render("#paypal-button-container")}clearInterval(a)},300);return()=>clearInterval(a)},[t.paymentMethod]),e.jsxs(v,{children:[e.jsx(N,{title:"Checkout"}),e.jsx("div",{className:"min-h-screen bg-gray-100 py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md border",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Resumen del pedido"}),d.length>0?e.jsxs(e.Fragment,{children:[e.jsx("ul",{className:"divide-y divide-gray-200",children:d.map((a,r)=>e.jsxs("li",{className:"py-3 flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[a.image&&e.jsx("img",{src:a.image,alt:a.name,className:"w-16 h-16 object-cover rounded"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-700",children:a.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:[a.quantity," x ",Number(a.price).toFixed(2)," €"]})]})]}),e.jsxs("p",{className:"font-semibold text-gray-800",children:[(a.quantity*Number(a.price)).toFixed(2)," €"]})]},r))}),e.jsx("div",{className:"border-t mt-4 pt-4 text-right",children:e.jsxs("p",{className:"text-xl font-bold text-gray-900",children:["Total: ",l.toFixed(2)," €"]})})]}):e.jsx("p",{className:"text-gray-500",children:"Tu carrito está vacío."})]}),e.jsxs("form",{onSubmit:b,className:"bg-white p-8 rounded-lg shadow-md border space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800",children:"Finalizar compra"}),e.jsx("input",{type:"text",name:"name",value:t.name,onChange:n,placeholder:"Nombre completo",className:"w-full border rounded px-4 py-2",required:!0}),e.jsx("input",{type:"email",name:"email",value:t.email,onChange:n,placeholder:"Correo electrónico",className:"w-full border rounded px-4 py-2",required:!0}),e.jsx("input",{type:"text",name:"address",value:t.address,onChange:n,placeholder:"Dirección",className:"w-full border rounded px-4 py-2",required:!0}),e.jsx("input",{type:"text",name:"city",value:t.city,onChange:n,placeholder:"Ciudad",className:"w-full border rounded px-4 py-2",required:!0}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Método de pago"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"card",checked:t.paymentMethod==="card",onChange:n})," Tarjeta de crédito"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"paypal",checked:t.paymentMethod==="paypal",onChange:n})," PayPal"]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",name:"paymentMethod",value:"bank",checked:t.paymentMethod==="bank",onChange:n})," Transferencia bancaria"]})]})]}),t.paymentMethod==="card"&&e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"text",name:"cardNumber",value:t.cardNumber,onChange:n,placeholder:"Número de tarjeta",className:"w-full border rounded px-4 py-2"}),e.jsx("input",{type:"text",name:"expirationDate",value:t.expirationDate,onChange:n,placeholder:"Fecha de expiración",className:"w-full border rounded px-4 py-2"})]}),e.jsxs("button",{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-semibold",children:["Confirmar y pagar ",l.toFixed(2)," €"]})]})]})})]})}export{k as default};
